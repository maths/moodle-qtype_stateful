define ("qtype_stateful/order",["jquery","qtype_stateful/ajaxvalidation"],function(a,b){function c(b,c,d,e){a(".stateful-order-list-blank",b).remove();for(var f={},g=0,h=a(b).children("div"),j=0;j<h.length;j++){var k=h[j],l=a(k);if(l.hasClass("stateful-order-list-fixed-item")){f[l.attr("data-token")]=g;g=0;if(e){if(!(0==c.length||"fixed"===c[0][0]&&c[0][1]===l.attr("data-token"))){l.before("<div class=\"stateful-order-list-blank\" data-token=\""+l.attr("data-token")+"\">?</div>")}}else{if(!(0==c.length||"fixed"===c[0][0]&&c[0][1][0]===l.attr("data-token"))){l.before("<div class=\"stateful-order-list-blank\" data-token=\""+l.attr("data-token")+"\">?</div>")}}}else{g++;l.before("<div class=\"stateful-order-list-blank\" data-token=\""+l.attr("data-token")+"\">?</div>")}}if(a(b).hasClass("stateful-order-list")){f["%%list%%"]=g}else{f["%%shuffle%%"]=g}if(0==c.length||"fixed"!==c[c.length-1][0]){if(a(b).hasClass("stateful-order-list")){a(b).append("<div class=\"stateful-order-list-blank\" data-token=\"%%list%%\">?</div>")}else{a(b).append("<div class=\"stateful-order-list-blank\" data-token=\"%%shuffle%%\">?</div>")}}var m={};g=0;for(var j=0,n;j<c.length;j++){n=c[j];if("fixed"===n[0]){if(e){m[n[1][0]]=g}else{m[n[1]]=g}g=0}else if("empty"===n[0]){g+=n[1]}else{g++}}if(a(b).hasClass("stateful-order-list")){m["%%list%%"]=g}else{m["%%shuffle%%"]=g}for(var o in m){if(m[o]>f[o]){var l=a(b).children(".stateful-order-list-blank").filter("[data-token=\""+a.escapeSelector(o)+"\"]");if(d){l.css("display","block")}else{l.css("display","inline-block")}}}}function d(b,c,d,e,f){for(var g={},h=0,k=0,l;k<d.length;k++){l=d[k];if("fixed"===l[0]){if(f){g[l[1][0]]=h}else{g[l[1]]=h}h=0}else if("empty"===l[0]){if(2<l.length){h+=l[2]}else{h+=l[1]}}else{h++}}if(0===d.length){h=999}if(a(b).hasClass("stateful-order-list")){g["%%list%%"]=h}else{g["%%shuffle%%"]=h}for(var m={},n=[],o=null,p=a(b).children("div"),k=0;k<p.length;k++){var q=p[k],r=a(q);if(r.hasClass("stateful-order-list-blank")){if(o!==c&&r.attr("data-token")!==c){n[n.length]=r}}if(r.hasClass("stateful-order-list-fixed-item")){m[r.attr("data-token")]=n;n=[]}if(r.hasClass("stateful-order-list-item")){o=r.attr("data-token")}}if(a(b).hasClass("stateful-order-list")){m["%%list%%"]=n}else{m["%%shuffle%%"]=n}for(var s in g){if(g[s]>=m[s].length){for(var t=0;t<m[s].length;t++){r=m[s][t];if(e){r.css("display","block")}else{r.css("display","inline-block")}}}}}function e(b,c,d,e){var f=a("div.stateful-order-list-item[data-token=\""+a.escapeSelector(c)+"\"]",b.parentElement.parentElement.parentElement);f.detach();a(b).before(f[0]);var g=a(b).attr("data-token"),h=a(document.getElementById(d)),j=JSON.parse(h.val());if(e){j=j.filter(function(a){return a[0]!==c})}else{j=j.filter(function(a){return a!==c})}if("%%list%%"===g){if(e){j[j.length]=[c,f.data("indent")]}else{j[j.length]=c}}else if(!e&&0<=j.indexOf(g)){j.splice(j.indexOf(g),0,c)}else if(e){var k=[],l=!0,m=!1,n=void 0;try{for(var o=j[Symbol.iterator](),p,q;!(l=(p=o.next()).done);l=!0){q=p.value;if(q[0]===g){k[k.length]=[c,f.data("indent")]}k[k.length]=q}}catch(a){m=!0;n=a}finally{try{if(!l&&null!=o.return){o.return()}}finally{if(m){throw n}}}j=k}h.val(JSON.stringify(j));var r=a(document.getElementById(d+"__sb"));if(0<r.length){j=JSON.parse(r.val());if(e){j=j.filter(function(a){return a[0]!==c})}else{j=j.filter(function(a){return a!==c})}if("%%shuffle%%"===g){if(e){j[j.length]=[c,f.data("indent")]}else{j[j.length]=c}}else if(!e&&0<=j.indexOf(g)){j.splice(j.indexOf(g),0,c)}else if(e){var k=[],s=!0,t=!1,u=void 0;try{for(var v=j[Symbol.iterator](),w,q;!(s=(w=v.next()).done);s=!0){q=w.value;if(q[0]===g){k[k.length]=[c,f.data("indent")]}k[k.length]=q}}catch(a){t=!0;u=a}finally{try{if(!s&&null!=v.return){v.return()}}finally{if(t){throw u}}}j=k}r.val(JSON.stringify(j))}h.trigger("input");h.trigger("change")}function f(b,c,d,e,f){var g=b.data("indent")+c;if(0>g||g>d){return}var h="";if(0<g){h="&nbsp;".repeat(e).repeat(g)}b.data("indent",g);b.find(".stateful-order-indent").html(h);var i=a(document.getElementById(f)),j=JSON.parse(i.val()),k=!1;j=j.map(function(a){if(a[0]===b.attr("data-token")){a[1]=g;k=!0}return a});if(k){i.val(JSON.stringify(j));i.trigger("input");i.trigger("change")}k=!1;i=a(document.getElementById(f+"__sb"));j=JSON.parse(i.val());j=j.map(function(a){if(a[0]===b.attr("data-token")){a[1]=g;k=!0}return a});if(k){i.val(JSON.stringify(j));i.trigger("input");i.trigger("change")}}return{inPlaceInit:function inPlaceInit(f,g,h){if(!g){var i=a(document.getElementById(f).parentElement),j=a(".stateful-order-list",i);c(j,[],h,!1);i.find(".stateful-order-list-item").attr("draggable","true");i.find(".stateful-order-list-item").on("dragstart",function(b){b.originalEvent.dataTransfer.setData("text/plain",a(b.target).attr("data-token"));b.originalEvent.dataTransfer.effectAllowed="move";setTimeout(function(){d(j,a(b.target).attr("data-token"),[],h,!1);i.find(".stateful-order-list-blank").on("drop",function(a){a.preventDefault();e(a.target,a.originalEvent.dataTransfer.getData("text/plain"),f,!1)});i.find(".stateful-order-list-blank").on("dragover",function(a){a.preventDefault();a.originalEvent.dataTransfer.dropEffect="move"})},20)});i.find(".stateful-order-list-item").on("dragend",function(){c(j,[],h,!1)})}setTimeout(function(){b.executeListeners()},20)},fillInInit:function fillInInit(f,g,h,i){if(!h){var j=a(document.getElementById(f).parentElement),k=a(".stateful-order-list",j),l=a(".stateful-order-shufflebox",j),m=j.data("template");c(k,m,i,!1);c(l,[],i,!1);j.find(".stateful-order-list-item").attr("draggable","true");j.find(".stateful-order-list-item").on("dragstart",function(b){b.originalEvent.dataTransfer.setData("text/plain",a(b.target).attr("data-token"));b.originalEvent.dataTransfer.effectAllowed="move";setTimeout(function(){d(k,a(b.target).attr("data-token"),m,i,!1);d(l,a(b.target).attr("data-token"),[],i,!1);j.find(".stateful-order-list-blank").on("drop",function(a){a.preventDefault();e(a.target,a.originalEvent.dataTransfer.getData("text/plain"),f,!1)});j.find(".stateful-order-list-blank").on("dragover",function(a){a.preventDefault();a.originalEvent.dataTransfer.dropEffect="move"})},20)});j.find(".stateful-order-list-item").on("dragend",function(){c(k,m,i,!1);c(l,[],i,!1)})}setTimeout(function(){b.executeListeners()},20)},fillInIndentInit:function fillInIndentInit(g,h,i){if(!i){var j=a(document.getElementById(g).parentElement),k=a(".stateful-order-list",j),l=a(".stateful-order-shufflebox",j),m=j.data("template"),n=j.data("indent"),o=j.data("maxindent");c(k,m,!1,!0);c(l,[],!1,!0);j.find(".stateful-order-list-item").attr("draggable","true");j.find(".stateful-order-list-item").on("dragstart",function(b){b.originalEvent.dataTransfer.setData("text/plain",a(b.target).attr("data-token"));b.originalEvent.dataTransfer.effectAllowed="move";setTimeout(function(){d(k,a(b.target).attr("data-token"),m,!1,!0);d(l,a(b.target).attr("data-token"),[],!1,!0);j.find(".stateful-order-list-blank").on("drop",function(a){a.preventDefault();e(a.target,a.originalEvent.dataTransfer.getData("text/plain"),g,!0)});j.find(".stateful-order-list-blank").on("dragover",function(a){a.preventDefault();a.originalEvent.dataTransfer.dropEffect="move"})},20)});j.find(".stateful-order-list-item").on("dragend",function(){c(k,m,!1,!0);c(l,[],!1,!0)});j.find(".stateful-order-list-item").append("<div class=\"stateful-order-indent-plus\" style=\"display:none;\">\u21E5</div>");j.find(".stateful-order-list-item").append("<div class=\"stateful-order-indent-minus\" style=\"display:none;\">\u21E4</div>");j.find(".stateful-order-indent-plus").on("click",function(b){b.preventDefault();f(a(b.target.parentElement),1,o,n,g)});j.find(".stateful-order-indent-minus").on("click",function(b){b.preventDefault();f(a(b.target.parentElement),-1,o,n,g)});j.find(".stateful-order-list-item").on("mouseenter",function(b){var c=a(b.target);c.find(".stateful-order-indent-plus").show();c.find(".stateful-order-indent-minus").show()});j.find(".stateful-order-list-item").on("mouseleave",function(b){var c=a(b.target);c.find(".stateful-order-indent-plus").hide();c.find(".stateful-order-indent-minus").hide()});j.on("mouseenter",function(b){var c=a(b.target);c.find(".stateful-order-indent-plus").hide();c.find(".stateful-order-indent-minus").hide()})}setTimeout(function(){b.executeListeners()},20)}}});
//# sourceMappingURL=order.min.js.map
